<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSS Reader ‚Äì Zinparen Instant</title>

<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
  .container { max-width: 700px; margin: auto; padding: 12px; }

  .nav-bar { display: flex; justify-content: space-between; align-items: center;
             margin-bottom: 12px; padding: 4px 0; border-bottom: 1px solid #ddd; }
  .nav-bar a { text-decoration: none; color: #0078ff; font-size: 14px; font-weight: bold; }
  #syncStatus { font-size: 10px; color: #888; margin-left: 8px; }

  mark.custom-highlight { background-color: #ffeb3b; color: #000; padding: 0 1px; border-radius: 2px; }

  select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc;
           font-size: 14px; background: white; margin-bottom: 10px; }

  .carousel { display: flex; overflow-x: scroll; scroll-snap-type: x mandatory; gap: 10px;
              padding: 10px 0; -webkit-overflow-scrolling: touch; }
  .slide { min-width: 75%; background: white; padding: 6px; border-radius: 10px;
           scroll-snap-align: center; box-shadow: 0 1px 4px rgba(0,0,0,0.15);
           height: 120px; display: flex; align-items: center; justify-content: center;
           cursor: pointer; }
  .slide img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }

  .article { background: white; padding: 20px; margin-top: 12px; border-radius: 12px;
             line-height: 1.25; font-size: 15px; opacity: 0; animation: fadeIn 0.4s forwards; }
  .article h2 { font-size: 18px; margin-top: 0; line-height: 1.2; margin-bottom: 20px; }

  /* ZINPAAR CONTAINER - BELANGRIJK */
  .sentence-pair {
    margin-bottom: 16px;
    padding: 12px;
    border-radius: 8px;
    background: white;
    border: 1px solid #e0e0e0;
    transition: all 0.3s ease;
  }

  .sentence-pair.ready {
    background: #f8fff8;
    border-color: #c8e6c9;
    box-shadow: 0 2px 8px rgba(200, 230, 201, 0.3);
  }

  .sentence-pair.loading {
    background: #f8f9fa;
    border-left: 4px solid #0078ff;
  }

  .dutch-sentence {
    display: block;
    margin-bottom: 8px;
    line-height: 1.4;
    color: #333;
    font-size: 15px;
    font-weight: 500;
  }

  .portuguese-sentence {
    display: block;
    color: #003399;
    font-style: italic;
    line-height: 1.4;
    margin-left: 10px;
    padding: 8px 10px;
    border-radius: 6px;
    background: #f8f9fa;
    border-left: 3px solid #0078ff;
    min-height: 24px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .portuguese-sentence:hover {
    background: #f0f7ff;
    transform: translateX(2px);
  }

  .portuguese-sentence.loading {
    color: #6c757d;
    font-style: normal;
    background: linear-gradient(90deg, #f8f9fa 25%, #e9ecef 50%, #f8f9fa 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }

  .portuguese-sentence.ready {
    background: #e8f5e9;
    border-left-color: #4caf50;
  }

  /* Grammatica markering */
  .portuguese-sentence strong {
    font-weight: bold !important;
  }

  .portuguese-sentence .noun {
    color: #8b0000 !important;
  }

  /* Priority queue - eerste zinnen krijgen voorrang */
  .priority-queue {
    position: sticky;
    top: 10px;
    background: #0078ff;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    margin-bottom: 15px;
    font-size: 14px;
    display: none;
    z-index: 100;
  }

  /* Stats */
  .translation-stats {
    display: flex;
    justify-content: space-between;
    background: #e3f2fd;
    padding: 10px 15px;
    border-radius: 8px;
    margin: 15px 0;
    font-size: 14px;
    color: #1565c0;
    border: 1px solid #bbdefb;
  }

  .toggle-row { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }

  .audio-controls {
    display: none;
    gap: 12px;
    margin-bottom: 12px;
    flex-wrap: wrap;
  }

  .audio-btn {
    flex: 1;
    padding: 10px;
    font-size: 15px;
    border: none;
    border-radius: 6px;
    background: #0078ff;
    color: white;
    font-weight: bold;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .audio-btn:hover {
    background: #0056cc;
  }

  .audio-btn:disabled {
    background: #6c757d;
    cursor: not-allowed;
  }

  .audio-btn.stop { background: #dc3545; }
  .audio-btn.stop:hover { background: #c82333; }
  .audio-btn.pause { background: #ffc107; color: #212529; }
  .audio-btn.pause:hover { background: #e0a800; }

  @keyframes fadeIn { to { opacity: 1; } }
  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* Snelle feedback */
  .quick-feedback {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #28a745;
    color: white;
    padding: 10px 16px;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: none;
    z-index: 1000;
    font-size: 14px;
  }
</style>
</head>
<body>

<!-- Quick Feedback -->
<div class="quick-feedback" id="quickFeedback"></div>

<div class="container">

  <div class="nav-bar">
    <div><strong>Reader</strong><span id="syncStatus"></span></div>
    <a href="woorden.html">Instellingen ‚öôÔ∏è</a>
  </div>

  <div class="toggle-row">
    <input type="checkbox" id="toggleTranslate" checked>
    <label for="toggleTranslate">Vertaling inschakelen</label>
  </div>

  <!-- GRAMMATICA MARKERING TOGGLE -->
  <div class="toggle-row">
    <input type="checkbox" id="toggleGrammar" checked>
    <label for="toggleGrammar">Werkwoorden (vet) & zelfstandige naamwoorden (rood) markeren</label>
  </div>

  <!-- Priority Queue Indicator -->
  <div class="priority-queue" id="priorityQueue">
    ‚ö° <strong>Eerste 8 zinnen krijgen voorrang</strong> - je kunt direct beginnen lezen!
  </div>

  <!-- Translation Stats -->
  <div class="translation-stats" id="translationStats" style="display: none;">
    <span id="statsProgress">0/0 zinnen klaar</span>
    <span id="statsSpeed">~ 0s resterend</span>
  </div>

  <!-- AUDIO BUTTONS -->
  <div id="audioControls" class="audio-controls">
    <button class="audio-btn" onclick="speakTranslation()" id="speakBtn">‚ñ∂Ô∏è Afspelen</button>
    <button class="audio-btn pause" onclick="pauseSpeaking()">‚è∏Ô∏è Pauze</button>
    <button class="audio-btn stop" onclick="stopSpeaking()">‚èπÔ∏è Stop</button>
  </div>

  <select id="feedSelect" onchange="loadSelectedFeed()"></select>
  <div id="carousel" class="carousel"></div>
  
  <!-- ARTICLE -->
  <div id="article" class="article"></div>

</div>

<script>
let items = [];
let currentIndex = 0;
let currentArticleData = null;
let isTranslating = false;
let translationQueue = [];

/* ========= INSTANT ZINPAREN RENDERING ========= */

async function loadArticle(index) {
  stopSpeaking();
  stopTranslation();
  
  const container = document.getElementById("article");
  container.style.opacity = 0;
  currentIndex = index;

  try {
    const link = items[index]?.link;
    if (!link) return;

    // Super snel: toon "laden" en haal data op
    container.innerHTML = "<div style='padding: 20px; text-align: center;'>Artikel laden...</div>";
    container.style.opacity = 1;

    const resp = await fetch(`/api/article?url=${encodeURIComponent(link)}`);
    const data = await resp.json();
    const words = JSON.parse(localStorage.getItem("highlightWords") || "[]");

    const html = data.content;
    const title = data.title || "";

    // Extract zinnen
    const temp = document.createElement("div");
    temp.innerHTML = html;
    const text = temp.textContent || temp.innerText || "";
    const sentences = splitIntoSentences(text);
    
    currentArticleData = {
      title: title,
      sentences: sentences,
      highlightWords: words,
      translations: new Array(sentences.length).fill(null)
    };

    // BELANGRIJK: Render ALLE zinparen DIRECT
    renderAllSentencePairs(sentences, title, words);
    
    // Toon stats
    document.getElementById('translationStats').style.display = 'flex';
    document.getElementById('priorityQueue').style.display = 'block';
    updateStats(0, sentences.length);
    
    // Start vertaling als ingeschakeld
    const translateOn = document.getElementById("toggleTranslate").checked;
    if (translateOn && sentences.length > 0) {
      document.getElementById("audioControls").style.display = "flex";
      document.getElementById("speakBtn").disabled = true;
      
      // START HIER: Priority vertaling voor eerste zinnen
      translateWithPriority(sentences, "pt-BR");
    } else {
      document.getElementById("audioControls").style.display = "none";
    }

  } catch (error) {
    console.error("Fout bij laden artikel:", error);
    container.innerHTML = "<div style='padding: 20px; color: #dc3545;'>Fout bij laden van artikel.</div>";
    container.style.opacity = 1;
  }
}

function renderAllSentencePairs(sentences, title, words) {
  const container = document.getElementById("article");
  const translateOn = document.getElementById("toggleTranslate").checked;
  
  let html = `<h2>${applyHighlights(title, words)}</h2>`;
  
  // Render ALLE zinnen direct als paren
  sentences.forEach((sentence, index) => {
    const pairId = `pair-${index}`;
    const translationId = `trans-${index}`;
    
    html += `
      <div class="sentence-pair ${translateOn ? 'loading' : ''}" id="${pairId}">
        <span class="dutch-sentence">${applyHighlights(sentence, words)}</span>
        <span class="portuguese-sentence loading" 
               id="${translationId}"
               data-index="${index}"
               onclick="playSingleLine(${index})">
          ${translateOn ? 'Vertaling wordt geladen...' : 'Vertaling uitgeschakeld'}
        </span>
      </div>
    `;
  });
  
  container.innerHTML = html;
  container.style.opacity = 1;
}

/* ========= PRIORITY TRANSLATION STRATEGY ========= */

async function translateWithPriority(sentences, targetLang = "pt-BR") {
  if (isTranslating) return;
  isTranslating = true;
  
  const startTime = Date.now();
  const totalSentences = sentences.length;
  let translatedCount = 0;
  
  // STRATEGIE: Verdeel in 3 fasen voor optimale ervaring
  const PHASE1_SIZE = 8;   // Eerste 8 zinnen - HOOGSTE PRIORITEIT
  const PHASE2_SIZE = 12;  // Volgende 12 zinnen
  const PHASE3_SIZE = 20;  // Rest - laagste prioriteit
  
  showQuickFeedback("üöÄ Start vertaling: eerste zinnen krijgen voorrang!");
  
  // FASE 1: Eerste 8 zinnen - DIRECT voor lezen
  const phase1Sentences = sentences.slice(0, PHASE1_SIZE);
  if (phase1Sentences.length > 0) {
    await translateAndUpdateBatch(phase1Sentences, 0, targetLang);
    translatedCount += phase1Sentences.length;
    
    showQuickFeedback(`‚úÖ Eerste ${phase1Sentences.length} zinparen klaar! Begin met lezen.`);
    document.getElementById("speakBtn").disabled = false; // Kan nu al voorlezen
  }
  
  // FASE 2: Volgende 12 zinnen - parallel in batches van 4
  if (sentences.length > PHASE1_SIZE) {
    const phase2Sentences = sentences.slice(PHASE1_SIZE, PHASE1_SIZE + PHASE2_SIZE);
    const phase2Batches = createSmartBatches(phase2Sentences, 4);
    
    for (let i = 0; i < phase2Batches.length; i++) {
      const batch = phase2Batches[i];
      const startIdx = PHASE1_SIZE + (i * 4);
      await translateAndUpdateBatch(batch, startIdx, targetLang);
      translatedCount += batch.length;
      
      updateStats(translatedCount, totalSentences);
    }
  }
  
  // FASE 3: Rest - in grotere batches voor effici√´ntie
  if (sentences.length > PHASE1_SIZE + PHASE2_SIZE) {
    const phase3Sentences = sentences.slice(PHASE1_SIZE + PHASE2_SIZE);
    const phase3Batches = createSmartBatches(phase3Sentences, 8); // Grotere batches
    
    for (let i = 0; i < phase3Batches.length; i++) {
      const batch = phase3Batches[i];
      const startIdx = PHASE1_SIZE + PHASE2_SIZE + (i * 8);
      await translateAndUpdateBatch(batch, startIdx, targetLang);
      translatedCount += batch.length;
    }
  }
  
  // Voltooid
  const totalTime = Math.round((Date.now() - startTime) / 1000);
  updateStats(totalSentences, totalSentences);
  showQuickFeedback(`üéâ Alle ${totalSentences} zinnen vertaald in ${totalTime}s!`);
  
  isTranslating = false;
}

function createSmartBatches(sentences, batchSize) {
  const batches = [];
  for (let i = 0; i < sentences.length; i += batchSize) {
    batches.push(sentences.slice(i, i + batchSize));
  }
  return batches;
}

async function translateAndUpdateBatch(sentences, startIndex, targetLang) {
  try {
    const translations = await translateSentencesBatch(sentences, targetLang);
    
    // Update UI voor elke zin in de batch
    translations.forEach((translation, batchIndex) => {
      const sentenceIndex = startIndex + batchIndex;
      if (sentenceIndex < currentArticleData.sentences.length) {
        // Store in data
        currentArticleData.translations[sentenceIndex] = translation;
        
        // Update UI onmiddellijk
        updateSingleTranslation(sentenceIndex, translation);
      }
    });
    
    return translations;
  } catch (error) {
    console.error(`Batch vertaling mislukt:`, error);
    // Markeer als mislukt maar ga door
    sentences.forEach((_, batchIndex) => {
      const sentenceIndex = startIndex + batchIndex;
      updateSingleTranslation(sentenceIndex, 
        `<span style="color: #dc3545;">[Vertaling mislukt, probeer opnieuw]</span>`);
    });
    return sentences;
  }
}

function updateSingleTranslation(index, translation) {
  const translationEl = document.getElementById(`trans-${index}`);
  const pairEl = document.getElementById(`pair-${index}`);
  
  if (!translationEl || !pairEl) return;
  
  // Verwijder loading state
  translationEl.classList.remove('loading');
  pairEl.classList.remove('loading');
  
  // Voeg ready state toe
  translationEl.classList.add('ready');
  pairEl.classList.add('ready');
  
  // Pas grammatica markup toe
  const grammarEnabled = document.getElementById("toggleGrammar").checked;
  let translationHTML = translation || "";
  
  if (grammarEnabled && translationHTML) {
    translationHTML = translationHTML
      .replace(/<span style="color:darkred">/g, '<span class="noun">')
      .replace(/<span style="color: darkred">/g, '<span class="noun">');
  } else if (!grammarEnabled && translationHTML) {
    translationHTML = translationHTML
      .replace(/<strong>/g, '')
      .replace(/<\/strong>/g, '')
      .replace(/<span[^>]*>/g, '')
      .replace(/<\/span>/g, '');
  }
  
  translationEl.innerHTML = translationHTML;
  translationEl.onclick = () => playSingleLine(index);
}

function updateStats(completed, total) {
  const progressEl = document.getElementById('statsProgress');
  const speedEl = document.getElementById('statsSpeed');
  
  if (progressEl) {
    progressEl.textContent = `${completed}/${total} zinparen klaar`;
  }
  
  if (speedEl) {
    if (completed === 0) {
      speedEl.textContent = 'Start...';
    } else if (completed === total) {
      speedEl.textContent = 'üéâ Voltooid!';
    } else {
      const estimated = Math.round(((total - completed) / 4) * 3); // Schatting
      speedEl.textContent = `~ ${estimated}s resterend`;
    }
  }
}

function showQuickFeedback(message) {
  const feedback = document.getElementById('quickFeedback');
  feedback.textContent = message;
  feedback.style.display = 'block';
  
  setTimeout(() => {
    feedback.style.display = 'none';
  }, 3000);
}

function stopTranslation() {
  isTranslating = false;
  translationQueue = [];
}

/* ========= FIXED TRANSLATION BATCH ========= */

async function translateSentencesBatch(sentences, targetLang = "pt-BR") {
  if (sentences.length === 0) return [];
  
  console.log(`üîç Vertaal ${sentences.length} zinnen naar ${targetLang}`);
  
  try {
    const url = `/api/translate?sentences=${encodeURIComponent(JSON.stringify(sentences))}&target=${targetLang}`;
    
    const response = await fetch(url);
    
    if (!response.ok) {
      console.error(`‚ùå API error: ${response.status}`);
      return sentences;
    }
    
    const data = await response.json();
    
    // VERSCHILLENDE RESPONSE FORMATEN
    let translations = [];
    
    if (data.translations && Array.isArray(data.translations)) {
      translations = data.translations;
    } 
    else if (Array.isArray(data)) {
      translations = data;
    }
    else if (data.text) {
      translations = [data.text];
    }
    else {
      console.error('‚ùå Onbekend response format:', data);
      return sentences;
    }
    
    // VALIDATIE
    if (translations.length > 0) {
      const firstTrans = translations[0] || '';
      const firstOrig = sentences[0] || '';
      
      // Check of het Portugees is
      const portugueseChars = firstTrans.match(/[√°√†√¢√£√©√®√™√≠√¨√Æ√≥√≤√¥√µ√∫√π√ª√ß√±]/gi);
      
      if (firstTrans === firstOrig && (!portugueseChars || portugueseChars.length < 1)) {
        console.warn('‚ö†Ô∏è Vertaling lijkt niet gewerkt te hebben');
      }
    }
    
    return translations;
    
  } catch (error) {
    console.error('‚ùå Vertaling mislukt:', error);
    return sentences;
  }
}

/* ========= AUDIO ENGINE ========= */

let isSpeaking = false;
let isPaused = false;
let currentUtterance = null;
let currentLineIndex = 0;
let lines = [];

function getBrazilianVoice() {
  const voices = speechSynthesis.getVoices();
  return (
    voices.find(v => v.lang === "pt-BR") ||
    voices.find(v => v.lang.startsWith("pt")) ||
    voices[0]
  );
}

function speakTranslation() {
  if (isSpeaking) return;

  const article = document.getElementById("article");
  lines = [...article.querySelectorAll(".portuguese-sentence.ready")].map(el => {
    const temp = document.createElement('div');
    temp.innerHTML = el.innerHTML;
    temp.querySelectorAll('strong, .noun').forEach(tag => {
      tag.replaceWith(tag.textContent);
    });
    return temp.textContent.trim();
  }).filter(text => text.length > 0);

  if (lines.length === 0) {
    showQuickFeedback("‚ö†Ô∏è Nog geen vertaalde zinnen om voor te lezen");
    return;
  }

  const voice = getBrazilianVoice();
  isSpeaking = true;
  isPaused = false;
  currentLineIndex = 0;

  function speakNext() {
    if (!isSpeaking || currentLineIndex >= lines.length) {
      isSpeaking = false;
      return;
    }

    currentUtterance = new SpeechSynthesisUtterance(lines[currentLineIndex]);
    currentUtterance.voice = voice;
    currentUtterance.rate = 1.0;
    currentUtterance.pitch = 1.0;

    currentUtterance.onend = () => {
      if (!isPaused) {
        currentLineIndex++;
        setTimeout(speakNext, 300);
      }
    };

    speechSynthesis.speak(currentUtterance);
  }

  speakNext();
}

function pauseSpeaking() {
  if (!isSpeaking) return;
  if (!isPaused) {
    speechSynthesis.pause();
    isPaused = true;
  } else {
    speechSynthesis.resume();
    isPaused = false;
  }
}

function stopSpeaking() {
  isSpeaking = false;
  isPaused = false;
  speechSynthesis.cancel();
}

function playSingleLine(i) {
  stopSpeaking();
  const voice = getBrazilianVoice();
  const el = document.querySelector(`.portuguese-sentence[data-index="${i}"]`);
  if (!el || el.classList.contains('loading')) return;

  const temp = document.createElement('div');
  temp.innerHTML = el.innerHTML;
  temp.querySelectorAll('strong, .noun').forEach(tag => {
    tag.replaceWith(tag.textContent);
  });
  const text = temp.textContent.trim();

  if (!text) return;

  const u = new SpeechSynthesisUtterance(text);
  u.voice = voice;
  u.rate = 1.0;
  u.pitch = 1.0;

  speechSynthesis.speak(u);
}

/* ========= HELPER FUNCTIONS ========= */

function splitIntoSentences(text) {
  return text
    .replace(/\s+/g, " ")
    .trim()
    .split(/(?<![A-Z][a-z]\.)(?<![A-Z][a-z][a-z]\.)(?<![Mm]r\.)(?<![Mm]rs\.)(?<![Dd]r\.)(?<![Pp]rof\.)(?<![Ss]r\.)(?<![Jj]r\.)(?<![Vv]s\.)(?<![Ee]tc\.)(?<![Ee]g\.)(?<![Ii]e\.)(?<=[.!?])\s+/)
    .filter(s => s.trim().length > 0);
}

function applyHighlights(html, words) {
  if (!words || words.length === 0) return html;
  const pattern = [...words]
    .sort((a, b) => b.length - a.length)
    .map(w => w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'))
    .join("|");
  const regex = new RegExp(`\\b(${pattern})\\b(?=[^>]*<)`, "gi");
  return html.replace(regex, m => `<mark class="custom-highlight">${m}</mark>`);
}

/* ========= CLOUD SYNC + RSS ========= */

async function fetchCloudData(url) {
  if (!url) return [];
  try {
    const resp = await fetch(url);
    const text = await resp.text();
    return text.split(/[\r\n]+/).map(r => r.replace(/^"|"$/g, "").trim()).filter(r => r);
  } catch {
    return null;
  }
}

async function startSync() {
  const statusEl = document.getElementById("syncStatus");
  statusEl.textContent = "(Syncing...)";

  const wordUrl = localStorage.getItem("syncSheetUrl");
  const feedUrl = localStorage.getItem("syncFeedUrl");

  const [words, feeds] = await Promise.all([
    fetchCloudData(wordUrl),
    fetchCloudData(feedUrl)
  ]);

  if (words) localStorage.setItem("highlightWords", JSON.stringify(words));
  if (feeds) localStorage.setItem("rssFeeds", JSON.stringify(feeds));

  statusEl.textContent = words && feeds ? "(Cloud OK)" : "(Offline)";
}

function loadSavedFeeds() {
  const select = document.getElementById("feedSelect");
  const feeds = JSON.parse(localStorage.getItem("rssFeeds") || "[]");
  select.innerHTML = feeds.map(f => `<option value="${f}">${f}</option>`).join("");
  if (feeds.length > 0) loadFeed(feeds[0]);
}

async function loadFeed(url) {
  const carousel = document.getElementById("carousel");
  carousel.innerHTML = "Laden...";
  try {
    const resp = await fetch(
      `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`
    );
    const data = await resp.json();
    items = data.items || [];
    
    carousel.innerHTML = items
      .map((item, idx) => `<div class="slide" data-index="${idx}"><img src="${
        item.thumbnail ||
        (item.enclosure && item.enclosure.link) ||
        "https://via.placeholder.com/150"
      }"></div>`)
      .join("");
    
    setTimeout(() => {
      if (carousel.scrollLeft === 0) {
        loadArticle(0);
      }
    }, 100);
    
  } catch {
    carousel.innerHTML = "Fout bij laden feed.";
  }
}

function loadSelectedFeed() {
  loadFeed(document.getElementById("feedSelect").value);
}

/* ========= SWIPE ========= */

let carouselScrollTimeout;

document.getElementById("carousel").onscroll = () => {
  clearTimeout(carouselScrollTimeout);
  carouselScrollTimeout = setTimeout(() => {
    const slide = document.querySelector(".slide");
    if (!slide) return;
    const slideWidth = slide.offsetWidth + 10;
    const index = Math.round(document.getElementById("carousel").scrollLeft / slideWidth);
    if (index !== currentIndex && items[index]) {
      loadArticle(index);
    }
  }, 50);
};

document.getElementById("carousel").addEventListener("click", (e) => {
  const slide = e.target.closest(".slide");
  if (slide) {
    const index = parseInt(slide.dataset.index);
    if (!isNaN(index) && index !== currentIndex && items[index]) {
      slide.scrollIntoView({ behavior: 'smooth', inline: 'center' });
      loadArticle(index);
    }
  }
});

/* ========= TOGGLE EVENT LISTENERS ========= */

document.getElementById("toggleGrammar").addEventListener("change", function() {
  // Update grammatica voor al vertaalde zinnen
  if (currentArticleData && currentArticleData.translations) {
    currentArticleData.translations.forEach((translation, index) => {
      if (translation) {
        updateSingleTranslation(index, translation);
      }
    });
  }
});

document.getElementById("toggleTranslate").addEventListener("change", function() {
  if (items.length > 0) {
    loadArticle(currentIndex);
  }
});

/* ========= INIT ========= */

async function init() {
  await startSync();
  loadSavedFeeds();
}

init();

</script>
</body>
</html>
